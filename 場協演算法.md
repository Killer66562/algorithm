# 場協演算法

## 名詞
+ 時間段：
+ 跨日

## 流程
1. 各社團至系統上填寫需要的時間段，會根據時間段的細小程度決定各社團最多可填入的時間段。
2. 截止日後三日內，執行場協演算法並公告。
3. 場協演算法執行完成後三日內，開放社團於線上系統交換時間段，此時只能交換而無法添加。
4. 正式公告場協結果。

## 場協演算法

### 實作
1. 依日為單位，遍歷該日所有時間段。
2. 根據需要該時間段的社團優先度進行抽選。
3. 抽到該時間段之社團，根據其需要的時間段是否連續及連續的數量，決定其可實拿的時間段數量。
4. 調整所有參與本次抽選社團的優先度
    + 抽到該時間段者，根據其實拿的時間段數量調降優先度
    + 未抽到者，小幅調升其優先度。
    + 未參與該次抽選者，較大幅調升其優先度，以保證有機會和其他社團競爭接下來的時間段。

### 範例

#### 前提
農服、漁服、魔術三社
1/1 08:00-23:00 以30分鐘為一時間段

最小連續獲取時間段：4（2hr）
最大連續獲取時間段：8（4hr）

#### 需求
+ 農服需求：08:00-08:30、08:30-09:00、...、16:30-17:00
+ 漁服需求：10:00-10:30、10:30-11:00、...、21:30-22:00
+ 魔術需求：14:00-14:30、14:30-50:00、...、22:30-23:00

#### Rounds
+ R1
    + 起始時間段：08:00-08:30
    + 從「農服」中抽選
    + 抽中農服
    + 拿8個時間段，農服優先度-4
    + 「漁服、魔術」未參與抽選，優先度各+2
+ R2
    + 起始時間段：12:00-12:30
    + 從「農服、漁服」中抽選
    + 抽中漁服
    + 拿8個時間段，漁服優先度-4
    + 「農服」未抽中，優先度+1
    + 「魔術」未參與抽選，優先度+2
+ R3
    + 起始時間段：16:00-16:30
    + 從「農服、漁服、魔術」中抽選
    + 抽中魔術
    + 拿6個時間段，魔術優先度-3
    + 「農服、漁服」未抽中，優先度+1
+ R4
    + 起始時間段：19:00-19:30
    + 從「漁服、魔術」中抽選
    + 抽中漁服
    + 拿6個時間段，漁服優先度-3
    + 「魔術」未抽中，優先度+1
+ R5
    + 起始時間段：22:00-22:30
    + 從「魔術」中抽選
    + 抽中魔術
    + 拿2個時間段，魔術優先度-1

